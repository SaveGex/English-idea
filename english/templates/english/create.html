{% extends 'base.html' %}

{% block head_addition %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'english/create_form.css' %}">
    <style>
        #text_area {
            max-height: 300px; 
            height: 300px; 
            line-height: 1.5; 
        }
        body{
            overflow-x: hidden;
        }
        decor{
            max-width: 800px;
        }
        .modal_background {
            background-color: rgb(162 200 238) !important;
        }
    </style>
{% endblock %}

{% block body_class %}{% endblock %}

{% block content %}
    {% block navbar %}{% endblock %}

    <form method="post" class="decor">
        {% csrf_token %}
        <div class="form-left-decoration"></div>
        <div class="form-right-decoration"></div>
        <div class="circle"></div>
        <div class="form-inner">
            <h3 id="create_post">Create post <button id = "grate" class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">#</button>

                <div  class="offcanvas offcanvas-start modal_background " data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
                  <div class="offcanvas-header">
                    <h5 class="" id="offcanvasWithBothOptionsLabel">{{head_instruction|safe}}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                  </div>
                  <div class=" p-3">
                    <p>{{body_instruction|safe}}</p>
                  </div>
                </div></h3>
            
            
           
            {% if name_error %}
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    <strong>Name is required!</strong> {{name_error}}.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endif %}            
            <input type="name" name = 'name' class="background-input" placeholder="Name of task" value="{{form_data.name}}">

            {% if comment_error %}
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    <strong>Comment is required!</strong> {{comment_error}}.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endif %}
            <input type="comment" name = "comment" class="background-input" placeholder="Write comment" value="{{form_data.comment}}">

            {% if sentence_error %}
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    <strong>Sentence is required!</strong> {{sentence_error}}.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endif %}
            {% comment %}<textarea id="text_area" name = "sentence" class="py-2 background-input" placeholder="Sentence..." rows="3">{{form_data.sentence}}</textarea>{% endcomment %}
            <div class="container">
                <div id="highlightedText"></div>
                <textarea id="text_area" name="sentence" placeholder="Sentence..."></textarea>
            </div>
            <input type="submit" value="Send">
            
        </div>
    </form>
    {% block script %}
    <script>
        const textArea = document.getElementById('text_area');
        const highlightedText = document.getElementById('highlightedText');

        function highlightText(text) {
            // Escape HTML special characters
            text = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');

            // Replace text between _ with highlighted spans
            let highlighted = text.replace(/_(.*?)_/g, function(match, p1) {
                return `<span class="highlight-start">${p1}</span>`;
            });

            // Replace last _ with highlighted span
            highlighted = highlighted.replace(/_(.*?)$/, function(match, p1) {
                return `<span class="highlight-end">${p1}</span>`;
            });

            return highlighted;
        }

        function updateHighlighting() {
            const text = textArea.value;
            highlightedText.innerHTML = highlightText(text);
        }

        textArea.addEventListener('input', updateHighlighting);

        // Sync initial text area value with highlightedText
        updateHighlighting();
    </script>
    {% endblock %}
{% endblock %}